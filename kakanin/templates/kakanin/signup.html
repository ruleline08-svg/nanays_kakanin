{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Up - Nanay's Kakanin</title>
  <link rel="stylesheet" href="{% static 'kakanin/dist/output.css' %}">
  <link rel="icon" href="{% static 'kakanin/img/logo.png' %}" type="image/png">
</head>
<body class="bg-green-100 flex items-center justify-center min-h-screen py-8">

  <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
    <h2 class="text-2xl font-bold text-center text-green-600 mb-2">Create Account</h2>
    <p class="text-center text-sm text-gray-600 mb-6">Step {{ step|default:'1' }} of 2</p>

    <form method="POST" class="space-y-4">
      {% csrf_token %}
      <input type="hidden" name="step" value="{{ step|default:'1' }}" />

      {% if form.errors %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
          <p class="font-bold mb-2">Please correct the following errors:</p>
          <ul class="list-disc list-inside space-y-1">
            {% for field, errors in form.errors.items %}
              {% for error in errors %}
                <li class="text-sm">
                  {% if field == '__all__' %}
                    {{ error }}
                  {% elif field == 'password2' %}
                    <strong>Password:</strong> {{ error }}
                  {% else %}
                    <strong>{{ field|title }}:</strong> {{ error }}
                  {% endif %}
                </li>
              {% endfor %}
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      
      {% if form.non_field_errors %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
          {% for error in form.non_field_errors %}
            <p class="text-sm">{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}

      {% if step == '2' %}
        <!-- Step 2: Credentials -->
        <div>
          <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-700">Username</label>
          {{ form.username }}
        </div>
        <div>
          <label for="{{ form.password1.id_for_label }}" class="block text-sm font-medium text-gray-700">Password</label>
          <div class="relative">
            {{ form.password1 }}
            <button type="button" onclick="togglePassword('{{ form.password1.id_for_label }}', this)" 
              class="password-toggle absolute inset-y-0 right-0 px-3">
              <svg class="toggle-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M0 0h24v24H0V0z" fill="none"/>
                <path d="M12 6a9.77 9.77 0 0 1 8.82 5.5 9.77 9.77 0 0 1-8.82 5.5A9.77 9.77 0 0 1 3.18 11.5 9.77 9.77 0 0 1 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5a2.5 2.5 0 0 1 0 5 2.5 2.5 0 0 1 0-5m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"/>
              </svg>
            </button>
          </div>
          
          <!-- Live Password Requirements Checker -->
          <div class="mt-3 bg-gray-50 border border-gray-200 rounded-lg p-3">
            <ul class="space-y-2 text-sm">
              <li id="req-length" class="flex items-center gap-2 text-gray-500">
                <span class="check-icon">‚óã</span>
                <span>8-20 characters</span>
              </li>
              <li id="req-uppercase" class="flex items-center gap-2 text-gray-500">
                <span class="check-icon">‚óã</span>
                <span>At least one capital letter (A to Z)</span>
              </li>
              <li id="req-lowercase" class="flex items-center gap-2 text-gray-500">
                <span class="check-icon">‚óã</span>
                <span>At least one lowercase letter (a to z)</span>
              </li>
              <li id="req-number" class="flex items-center gap-2 text-gray-500">
                <span class="check-icon">‚óã</span>
                <span>At least one number (0 to 9)</span>
              </li>
              <li id="req-no-spaces" class="flex items-center gap-2 text-gray-500">
                <span class="check-icon">‚óã</span>
                <span>No spaces</span>
              </li>
            </ul>
          </div>
        </div>
        <div>
          <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-gray-700">Confirm Password</label>
          <div class="relative">
            {{ form.password2 }}
            <button type="button" onclick="togglePassword('{{ form.password2.id_for_label }}', this)" 
              class="password-toggle absolute inset-y-0 right-0 px-3">
              <svg class="toggle-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M0 0h24v24H0V0z" fill="none"/>
                <path d="M12 6a9.77 9.77 0 0 1 8.82 5.5 9.77 9.77 0 0 1-8.82 5.5A9.77 9.77 0 0 1 3.18 11.5 9.77 9.77 0 0 1 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5a2.5 2.5 0 0 1 0 5 2.5 2.5 0 0 1 0-5m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="flex items-center justify-between gap-3 pt-2">
          <a href="{% url 'signup' %}?step=1" title="Back" aria-label="Back"
             class="w-1/3 inline-flex items-center justify-center gap-2 border border-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-50">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
              <path fill-rule="evenodd" d="M15.78 19.28a.75.75 0 01-1.06 0l-7-7a.75.75 0 010-1.06l7-7a.75.75 0 111.06 1.06L9.06 11.25l6.72 6.72a.75.75 0 010 1.06z" clip-rule="evenodd" />
            </svg>
            <span class="hidden sm:inline">Back</span>
          </a>
          <button type="submit" class="flex-1 bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">Create Account</button>
        </div>

      {% else %}
        <!-- Step 1: Personal info -->
        <div>
          <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700">First name</label>
          {{ form.first_name }}
        </div>
        <div>
          <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700">Last name</label>
          {{ form.last_name }}
        </div>
        <div>
          <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700">Email <span class="text-red-500">*</span></label>
          {{ form.email }}
        </div>
        <div>
          <label for="{{ form.phone.id_for_label }}" class="block text-sm font-medium text-gray-700">Phone number <span class="text-red-500">*</span></label>
          {{ form.phone }}
        </div>
        <div>
          <label for="{{ form.birth_date.id_for_label }}" class="block text-sm font-medium text-gray-700">Birthdate</label>
          {{ form.birth_date }}
        </div>
        
        <!-- Delivery Address Section -->
        <div class="border-t pt-4 mt-4">
          <h3 class="text-lg font-semibold text-gray-800 mb-3">üìç Delivery Address</h3>
          <p class="text-xs text-gray-600 mb-3 bg-blue-50 p-2 rounded">
            ‚ÑπÔ∏è Delivery is available only within the Municipality of Naval, Biliran.
          </p>
          
          <div class="space-y-3">
            <div>
              <label for="{{ form.barangay.id_for_label }}" class="block text-sm font-medium text-gray-700">Barangay <span class="text-red-500">*</span></label>
              {{ form.barangay }}
            </div>
            <div>
              <label for="{{ form.zone.id_for_label }}" class="block text-sm font-medium text-gray-700">Zone / Purok <span class="text-red-500">*</span></label>
              {{ form.zone }}
            </div>
            <div>
              <label for="{{ form.additional_notes.id_for_label }}" class="block text-sm font-medium text-gray-700">Additional Notes / Nearest Landmark</label>
              {{ form.additional_notes }}
              <p class="text-xs text-gray-500 mt-1">e.g., Near church, beside barangay hall, yellow gate</p>
            </div>
          </div>
        </div>
        
        <div class="pt-2">
          <button type="submit" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">Next</button>
        </div>
      {% endif %}
    </form>

    <p class="text-center text-sm text-gray-700 mt-4">
      Already have an account? 
      <a href="{% url 'login' %}" class="text-green-600 hover:underline">Login</a>
    </p>
    <p class="text-center text-sm text-gray-700 mt-2">
      <a href="{% url 'home' %}" class="text-gray-600 hover:underline">‚Üê Back to Home</a>
    </p>
  </div>

  <style>
    input, textarea, select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      outline: none;
      background-color: white;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.4);
    }
    select {
      cursor: pointer;
    }
    
    /* Password toggle button styling */
    .password-toggle {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .password-toggle:hover {
      background-color: rgba(34, 197, 94, 0.1);
    }
    
    .password-toggle:active {
      background-color: rgba(34, 197, 94, 0.2);
    }
    
    .toggle-icon {
      width: 20px;
      height: 20px;
      color: #22c55e;
      transition: color 0.2s;
    }
    
    .password-toggle:hover .toggle-icon {
      color: #16a34a;
    }
  </style>

  <script>
    function togglePassword(fieldId, button) {
      const field = document.getElementById(fieldId);
      const icon = button.querySelector('svg');
      
      if (field.type === "password") {
        field.type = "text";
        // Change to visibility off icon (eye with slash)
        icon.innerHTML = `
          <path d="M0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0zm0 0h24v24H0V0z" fill="none"/>
          <path d="M12 6a9.77 9.77 0 0 1 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5A9.77 9.77 0 0 1 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5a2.5 2.5 0 0 1 0 5 2.5 2.5 0 0 1 0-5m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"/>
          <path d="M15.5 11.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z"/>
        `;
      } else {
        field.type = "password";
        // Change back to visibility icon (eye)
        icon.innerHTML = `
          <path d="M0 0h24v24H0V0z" fill="none"/>
          <path d="M12 6a9.77 9.77 0 0 1 8.82 5.5 9.77 9.77 0 0 1-8.82 5.5A9.77 9.77 0 0 1 3.18 11.5 9.77 9.77 0 0 1 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5a2.5 2.5 0 0 1 0 5 2.5 2.5 0 0 1 0-5m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"/>
        `;
      }
    }

    // Live password validation
    document.addEventListener('DOMContentLoaded', function() {
      const passwordField = document.getElementById('{{ form.password1.id_for_label }}');
      if (passwordField) {
        passwordField.addEventListener('input', function() {
          const password = this.value;
          
          // Check length (8-20 characters)
          const lengthValid = password.length >= 8 && password.length <= 20;
          updateRequirement('req-length', lengthValid);
          
          // Check uppercase
          const uppercaseValid = /[A-Z]/.test(password);
          updateRequirement('req-uppercase', uppercaseValid);
          
          // Check lowercase
          const lowercaseValid = /[a-z]/.test(password);
          updateRequirement('req-lowercase', lowercaseValid);
          
          // Check number
          const numberValid = /[0-9]/.test(password);
          updateRequirement('req-number', numberValid);
          
          // Check no spaces
          const noSpacesValid = !/\s/.test(password);
          updateRequirement('req-no-spaces', noSpacesValid);
        });
      }
    });

    function updateRequirement(elementId, isValid) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      const checkIcon = element.querySelector('.check-icon');
      
      if (isValid) {
        element.classList.remove('text-gray-500');
        element.classList.add('text-green-600');
        checkIcon.textContent = '‚úì';
        checkIcon.style.fontWeight = 'bold';
      } else {
        element.classList.remove('text-green-600');
        element.classList.add('text-gray-500');
        checkIcon.textContent = '‚óã';
        checkIcon.style.fontWeight = 'normal';
      }
    }
  </script>

</body>
</html>
