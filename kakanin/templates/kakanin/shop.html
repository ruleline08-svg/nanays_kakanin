{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nanay's Kakanin - Shop</title>
  <!-- Compiled Tailwind CSS -->
  <link rel="stylesheet" href="{% static 'kakanin/dist/output.css' %}">
  <!-- Custom overrides -->
  <link rel="stylesheet" href="{% static 'kakanin/style.css' %}">
  <link rel="icon" href="{% static 'kakanin/img/logo.png' %}" type="image/png">
</head>
<body style="background-color: #d4f1e8;">
  
  <!-- Navbar -->
  <header class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-8 py-4">
      <!-- Left: Logo + Name -->
      <div class="flex items-center space-x-3">
        <img src="{% static 'kakanin/img/logo.png' %}" alt="Logo" class="h-10 w-10 rounded-full">
        <span class="text-xl font-bold text-green-800">Nanay's Kakanin</span>
      </div>

      <!-- Center: Navigation Links -->
      <nav class="hidden md:flex items-center space-x-8 text-green-700 font-medium">
        <a href="{% url 'home' %}" class="hover:text-green-500">Home</a>
        <a href="{% url 'shop' %}" class="hover:text-green-500">Shop</a>
        <a href="{% url 'about' %}" class="hover:text-green-500">About</a>
        <a href="{% url 'contact' %}" class="hover:text-green-500">Contact</a>
      </nav>

      <!-- Right: Auth Buttons -->
       <div class="flex items-center space-x-4">
         <a href="{% url 'login' %}" class="px-4 py-2 border border-green-600 text-green-700 rounded-lg hover:bg-green-100">
           Login
         </a>
         <a href="{% url 'signup' %}" class="px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700">
          Sign Up
         </a>
        </div>
    </div>
  </header>

  <!-- Shop Content -->
  <main class="p-6 md:p-8 max-w-7xl mx-auto">
    <!-- Header Section with Title and Search -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
      <!-- Title -->
      <div>
        <h2 class="text-3xl md:text-4xl font-bold text-green-700 mb-1">Our Kakanin</h2>
        <p class="text-gray-600 text-sm">Discover our delicious traditional Filipino rice cakes</p>
      </div>

      <!-- Search Bar -->
      <div class="relative w-full md:w-96">
        <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-green-500 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <input type="text" id="searchInput" placeholder="Search for your favorite kakanin..." 
               class="w-full px-4 py-3 pl-12 pr-12 bg-white border-2 border-green-200 rounded-full focus:ring-2 focus:ring-green-400 focus:border-green-400 transition-all shadow-sm hover:shadow-md">
        <button id="clearSearch" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-green-600 transition-colors hidden">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- No Results Message -->
    <div id="noResults" class="hidden text-center py-12">
      <div class="text-gray-500 mb-4">
        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No products found</h3>
        <p class="text-gray-500 mb-4">Try adjusting your search terms</p>
        <button id="clearSearchBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
          Clear search
        </button>
      </div>
    </div>

    <!-- ADMIN ONLY: global manage buttons -->
    {% if is_admin %}
      <div class="mb-6 flex gap-3">
        <a href="{% url 'admin:kakanin_kakanin_add' %}" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded">
          + Add Product
        </a>
        <a href="{% url 'admin:kakanin_kakanin_changelist' %}" class="bg-gray-800 hover:bg-gray-900 text-white px-3 py-2 rounded">
          Manage Products
        </a>
      </div>
    {% endif %}

    <!-- Product Grid -->
    <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {% for k in kakanins %}
        <div class="product-card bg-white shadow rounded-lg p-4 border border-green-100 hover:shadow-lg transition"
             data-name="{{ k.name|lower }}" 
             data-description="{{ k.description|lower|default:'' }}">
          {% if k.image %}
            <img src="{{ k.image.url }}" alt="{{ k.name }}" class="w-full h-40 object-cover rounded mb-3">
          {% else %}
            <div class="w-full h-40 flex items-center justify-center bg-gray-200 text-gray-500 rounded mb-3">
              No image
            </div>
          {% endif %}
          <div class="mb-2">
            <h3 class="font-bold text-lg text-green-700">{{ k.name }}</h3>
          </div>
          <div class="flex items-center justify-between">
            <p class="text-gray-700 font-semibold">â‚±{{ k.price }}</p>
            {% if k.stock|default:0 > 0 %}
              <span class="text-xs text-gray-600">Available: {{ k.stock }} pcs</span>
            {% endif %}
          </div>
          {% if k.description %}
            <p class="text-sm text-gray-600 mt-2">{{ k.description }}</p>
          {% endif %}
          
          <!-- Availability Info -->
          <div class="mt-2">
            <p class="text-xs text-gray-500">{{ k.get_availability_display }}</p>
          </div>

          <!-- Admin controls -->
          {% if is_admin %}
            <div class="mt-3 flex gap-4 text-sm">
              <a href="{% url 'admin:kakanin_kakanin_change' k.id %}" class="text-green-600 hover:underline">Edit</a>
              <a href="{% url 'admin:kakanin_kakanin_delete' k.id %}" class="text-red-600 hover:underline">Delete</a>
            </div>
          {% elif user.is_authenticated %}
            <div class="mt-4 flex gap-2">
              {% if k.is_available and k.stock|default:0 > 0 %}
                <a href="{% url 'add_to_cart' k.id %}" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded">Add to Cart</a>
              {% endif %}
              <a href="{% url 'reserve' k.id %}" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">Reserve</a>
            </div>
          {% else %}
            <!-- Guest: prompt to login -->
            <div class="mt-4">
              <a href="{% url 'login' %}" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded">Login to buy</a>
            </div>
          {% endif %}
        </div>
      {% empty %}
        <p>No kakanin available yet.</p>
      {% endfor %}
    </div>
  </div>

  <script>
    // Search functionality for guest shop page
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchInput');
      const productsGrid = document.getElementById('productsGrid');
      const noResults = document.getElementById('noResults');
      const clearSearchBtn = document.getElementById('clearSearchBtn');
      const clearSearch = document.getElementById('clearSearch');
      const productCards = document.querySelectorAll('.product-card');

      function performSearch() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        let visibleCards = 0;

        // Show/hide clear button
        if (searchTerm) {
          clearSearch.classList.remove('hidden');
        } else {
          clearSearch.classList.add('hidden');
        }

        productCards.forEach(card => {
          const name = card.getAttribute('data-name');
          const description = card.getAttribute('data-description');
          
          if (searchTerm === '' || name.includes(searchTerm) || description.includes(searchTerm)) {
            card.style.display = 'block';
            visibleCards++;
          } else {
            card.style.display = 'none';
          }
        });

        // Show/hide no results message
        if (visibleCards === 0 && searchTerm !== '') {
          noResults.classList.remove('hidden');
          productsGrid.classList.add('hidden');
        } else {
          noResults.classList.add('hidden');
          productsGrid.classList.remove('hidden');
        }
      }

      // Real-time search as user types
      searchInput.addEventListener('input', performSearch);

      // Clear search functionality (both buttons)
      function clearSearchFunction() {
        searchInput.value = '';
        performSearch();
        searchInput.focus();
      }

      clearSearchBtn.addEventListener('click', clearSearchFunction);
      clearSearch.addEventListener('click', clearSearchFunction);
    });
  </script>

</body>
</html>
